<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=6AqfGK6s"></script>   <!-- Pronounce API -->
    <script src="{{ url_for('static', filename='snowfall.js') }}"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Translator</title>
</head>

<body style="background-color: black;">
    <div class="snowfall-container">
        <div class="snowfall"></div>
    </div>
    
    <div class="container mt-3">
        <div class="card">
            <h2 class="text-center mb-2 mt-4">Translator</h2>
            <div class="card-body">
                <ul class="nav nav-tabs mb-3">
                    <li class="nav-item">
                        <a class="nav-link active" id="text-tab" data-toggle="tab" href="#text-translation">Text</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="image-tab" data-toggle="tab" href="#image-translation">Image</a>
                    </li>
                </ul>
                
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="text-translation">
                        <form action="/translate" method="POST">
                            <div class="input-group mb-3">
                                <select class="custom-select" id="source-language-select" name="source_language">
                                    {% for code, name in target_languages %}
                                        <option value="{{ code }}">{{ name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="material-icons">To</i></span>
                                </div>
                                <select class="custom-select" id="visual-target-language" name="target_language">
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="it">Italian</option>
                                    <option value="pt">Portuguese</option>
                                    <option value="ru">Russian</option>
                                    <option value="zh">Chinese</option>
                                    <option value="ja">Japanese</option>
                                    <option value="ko">Korean</option>
                                    <option value="ar">Arabic</option>
                                    <option value="hi">Hindi</option>
                                    <option value="bn">Bengali</option>
                                    <option value="pa">Punjabi</option>
                                    <option value="sw">Swahili</option>
                                    <option value="tr">Turkish</option>
                                    <option value="he">Hebrew</option>
                                    <option value="tl">Tagalog</option>
                                    <option value="vi">Vietnamese</option>
                                    <option value="th">Thai</option>
                                    <option value="id">Indonesian</option>
                                    <option value="ms">Malay</option>
                                    <option value="el">Greek</option>
                                    <option value="pl">Polish</option>
                                    <option value="ro">Romanian</option>
                                    <option value="hu">Hungarian</option>
                                    <option value="sv">Swedish</option>
                                    <option value="da">Danish</option>
                                    <option value="no">Norwegian</option>
                                    <option value="fi">Finnish</option>
                                    <option value="cs">Czech</option>
                                    <option value="sk">Slovak</option>
                                    <option value="bg">Bulgarian</option>
                                    <option value="sr">Serbian</option>
                                    <option value="uk">Ukrainian</option>
                                    <option value="hr">Croatian</option>
                                    <option value="sl">Slovenian</option>
                                    <option value="et">Estonian</option>
                                    <option value="lt">Lithuanian</option>
                                    <option value="lv">Latvian</option>
                                    <option value="fa">Persian</option>
                                    <option value="mr">Marathi</option>
                                    <option value="gu">Gujarati</option>
                                    <option value="ta">Tamil</option>
                                    <option value="te">Telugu</option>
                                    <option value="kn">Kannada</option>
                                    <option value="ml">Malayalam</option>
                                    <option value="ne">Nepali</option>
                                    <option value="si">Sinhala</option>
                                    <option value="km">Khmer</option>
                                    <option value="my">Burmese</option>
                                    <option value="la">Latin</option>
                                    <option value="sq">Albanian</option>
                                    <option value="bs">Bosnian</option>
                                    <option value="mk">Macedonian</option>
                                    <option value="is">Icelandic</option>
                                    <option value="af">Afrikaans</option>
                                    <option value="zu">Zulu</option>
                                    <option value="yo">Yoruba</option>
                                    <option value="xh">Xhosa</option>
                                    <option value="am">Amharic</option>
                                    <option value="or">Odia</option>
                                </select>                                
                            </div>
                            
                            <div class="form-group">
                                <textarea class="form-control" id="text-to-translate" name="text" rows="3" placeholder="Enter text to translate"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="translated-text">Translated text:</label>
                            </div>
                            
                            <div id="snippet-container">
                                <pre id="snippet"></pre>
                                <span class="btn btn-secondary" id="pronounce-button"><i class="bi bi-volume-up"></i></span>
                                <button type="button" class="btn btn-primary" id="copy-button"><i class="bi bi-clipboard"></i></button>
                            </div>
                            
                            <button type="submit" class="btn btn-success" id="translate-button">Translate</button>
                        </form>
                    </div>
                    
                    <div class="tab-pane fade" id="image-translation">
                        <form id="visual-form">
                            <div class="form-group">
                                <label for="image-upload">Upload Image</label>
                                <input type="file" class="form-control-file" id="image-upload" accept="image/*">
                                <img id="preview-image" class="mt-2" style="max-width: 100%; display: none;">
                            </div>
                            
                            <div class="form-group">
                                <label for="visual-target-language">Target Language</label>
                                <select class="custom-select" id="visual-target-language" name="target_language">
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-success">Extract & Translate</button>
                            
                            <div class="mt-3">
                                <h5>Extracted Text:</h5>
                                <pre id="extracted-text" class="border p-2"></pre>
                                
                                <h5>Translation:</h5>
                                <pre id="visual-translation" class="border p-2"></pre>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById("translate-button").addEventListener("click", function(event) {
            event.preventDefault();
            const form = event.target.form;
            const formData = new FormData(form);
    
            fetch('/translate', {
                method: 'POST',
                body: formData,
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("snippet").textContent = data.translation;
                })
                .catch(error => console.error("Error:", error));
        });
    
        document.getElementById("pronounce-button").addEventListener("click", function() {
            const textToSpeak = document.getElementById("snippet").textContent;
            responsiveVoice.speak(textToSpeak, 'UK English Female', { delay: 0 });
        });
    
        document.getElementById("copy-button").addEventListener("click", function() {
            const snippetText = document.getElementById("snippet").textContent;
            navigator.clipboard.writeText(snippetText)
                .then(() => alert("Text copied to clipboard!"))
                .catch(err => console.error("Failed to copy text:", err));
        });
    
        document.getElementById('visual-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const imageInput = document.getElementById('image-upload');
            const formData = new FormData();
            
            if (!imageInput.files[0]) {
                alert('Please select an image first');
                return;
            }
            
            formData.append('image', imageInput.files[0]);
            formData.append('target_language', document.getElementById('visual-target-language').value);
            
            fetch('/visual-translate', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    document.getElementById('extracted-text').textContent = data.extracted_text;
                    document.getElementById('visual-translation').textContent = data.translation;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to process image. Please try again.');
            });
        });
    </script>

</body>
</html>
